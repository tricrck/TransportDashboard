{% extends "base.html" %}

{% block title %}Register - Kenya Transport Analytics{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 bg-gradient-to-br from-indigo-50 via-white to-purple-50">
    <div class="max-w-2xl w-full space-y-8">
        <!-- Header Section -->
        <div class="text-center">
            <div class="flex justify-center mb-6">
                <div class="w-20 h-20 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-xl transform hover:scale-105 transition-transform">
                    <i class="fas fa-chart-line text-white text-3xl"></i>
                </div>
            </div>
            <h2 class="text-4xl font-extrabold text-gray-900 mb-2">Create Your Account</h2>
            <p class="text-lg text-gray-600">Join Kenya's Unified Transport Analytics Platform</p>
            <div class="flex items-center justify-center space-x-2 mt-4">
                <div class="flex items-center space-x-1">
                    <i class="fas fa-shield-alt text-green-500"></i>
                    <span class="text-sm text-gray-600">Secure</span>
                </div>
                <span class="text-gray-400">•</span>
                <div class="flex items-center space-x-1">
                    <i class="fas fa-lock text-blue-500"></i>
                    <span class="text-sm text-gray-600">Encrypted</span>
                </div>
                <span class="text-gray-400">•</span>
                <div class="flex items-center space-x-1">
                    <i class="fas fa-check-circle text-indigo-500"></i>
                    <span class="text-sm text-gray-600">Verified</span>
                </div>
            </div>
        </div>

        <!-- Registration Form Card -->
        <div class="bg-white rounded-2xl shadow-2xl border border-gray-100 overflow-hidden">
            <div class="p-8 md:p-10">
                <form method="POST" action="{{ url_for('auth.register') }}" id="registrationForm">
                    {{ form.hidden_tag() }}
                    
                    <!-- Progress Indicator -->
                    <div class="mb-8">
                        <div class="flex items-center justify-between text-xs text-gray-500 mb-2">
                            <span>Complete your profile</span>
                            <span id="progressText">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="progressBar" class="bg-gradient-to-r from-indigo-500 to-purple-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Personal Information Section -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-user text-indigo-600 text-sm"></i>
                            </div>
                            Personal Information
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <!-- First Name -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    First Name <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-user text-gray-400"></i>
                                    </div>
                                    {{ form.first_name(
                                        class="pl-10 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all",
                                        placeholder="John",
                                        required=True
                                    ) }}
                                </div>
                                {% if form.first_name.errors %}
                                    <p class="mt-1 text-sm text-red-600"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.first_name.errors[0] }}</p>
                                {% endif %}
                            </div>

                            <!-- Last Name -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Last Name <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-user text-gray-400"></i>
                                    </div>
                                    {{ form.last_name(
                                        class="pl-10 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all",
                                        placeholder="Doe",
                                        required=True
                                    ) }}
                                </div>
                                {% if form.last_name.errors %}
                                    <p class="mt-1 text-sm text-red-600"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.last_name.errors[0] }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information Section -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-envelope text-blue-600 text-sm"></i>
                            </div>
                            Contact Information
                        </h3>
                        
                        <div class="space-y-4">
                            <!-- Email -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Email Address <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-envelope text-gray-400"></i>
                                    </div>
                                    {{ form.email(
                                        class="pl-10 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all",
                                        placeholder="john.doe@transport.go.ke",
                                        type="email",
                                        required=True
                                    ) }}
                                </div>
                                {% if form.email.errors %}
                                    <p class="mt-1 text-sm text-red-600"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.email.errors[0] }}</p>
                                {% endif %}
                                <p class="mt-1 text-xs text-gray-500">Use your official government email address</p>
                            </div>

                            <!-- Phone -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Phone Number
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-phone text-gray-400"></i>
                                    </div>
                                    {{ form.phone(
                                        class="pl-10 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all",
                                        placeholder="+254 700 000000"
                                    ) }}
                                </div>
                                {% if form.phone.errors %}
                                    <p class="mt-1 text-sm text-red-600"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.phone.errors[0] }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Organization Information Section -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-building text-purple-600 text-sm"></i>
                            </div>
                            Organization Details
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <!-- Organization -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Organization <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-building text-gray-400"></i>
                                    </div>
                                    {{ form.organization_id(
                                        class="pl-10 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all appearance-none",
                                        required=True
                                    ) }}
                                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                        <i class="fas fa-chevron-down text-gray-400"></i>
                                    </div>
                                </div>
                                {% if form.organization_id.errors %}
                                    <p class="mt-1 text-sm text-red-600"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.organization_id.errors[0] }}</p>
                                {% endif %}
                            </div>

                            <!-- Job Title -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Job Title
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-briefcase text-gray-400"></i>
                                    </div>
                                    {{ form.job_title(
                                        class="pl-10 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all",
                                        placeholder="Data Analyst"
                                    ) }}
                                </div>
                                {% if form.job_title.errors %}
                                    <p class="mt-1 text-sm text-red-600"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.job_title.errors[0] }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Security Section -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-lock text-green-600 text-sm"></i>
                            </div>
                            Security
                        </h3>
                        
                        <div class="space-y-4">
                            <!-- Password -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Password <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-lock text-gray-400"></i>
                                    </div>
                                    {{ form.password(
                                        class="pl-10 pr-10 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all",
                                        placeholder="••••••••",
                                        required=True,
                                        id="password"
                                    ) }}
                                    <button type="button" onclick="togglePassword('password', 'passwordIcon')" class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                        <i id="passwordIcon" class="fas fa-eye text-gray-400 hover:text-gray-600"></i>
                                    </button>
                                </div>
                                {% if form.password.errors %}
                                    <p class="mt-1 text-sm text-red-600"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.password.errors[0] }}</p>
                                {% endif %}
                                
                                <!-- Password Strength Indicator -->
                                <div class="mt-2">
                                    <div class="flex items-center space-x-2 text-xs">
                                        <div class="flex-1 h-1 bg-gray-200 rounded-full overflow-hidden">
                                            <div id="passwordStrength" class="h-full transition-all duration-300" style="width: 0%"></div>
                                        </div>
                                        <span id="passwordStrengthText" class="text-gray-500 font-medium">-</span>
                                    </div>
                                    <p class="mt-2 text-xs text-gray-500">
                                        Must contain: 8+ characters, uppercase, lowercase, number, special character
                                    </p>
                                </div>
                            </div>

                            <!-- Confirm Password -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Confirm Password <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-lock text-gray-400"></i>
                                    </div>
                                    {{ form.password_confirm(
                                        class="pl-10 pr-10 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all",
                                        placeholder="••••••••",
                                        required=True,
                                        id="confirmPassword"
                                    ) }}
                                    <button type="button" onclick="togglePassword('confirmPassword', 'confirmPasswordIcon')" class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                        <i id="confirmPasswordIcon" class="fas fa-eye text-gray-400 hover:text-gray-600"></i>
                                    </button>
                                </div>
                                {% if form.password_confirm.errors %}
                                    <p class="mt-1 text-sm text-red-600"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.password_confirm.errors[0] }}</p>
                                {% endif %}
                                <div id="passwordMatch" class="mt-1 text-xs hidden">
                                    <span class="text-green-600"><i class="fas fa-check-circle mr-1"></i>Passwords match</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Terms and Conditions -->
                    <div class="mb-6">
                        <div class="flex items-start">
                            <div class="flex items-center h-5">
                                {{ form.accept_terms(
                                    class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500",
                                    required=True
                                ) }}
                            </div>
                            <label class="ml-3 text-sm text-gray-600">
                                I agree to the <a href="#" class="text-indigo-600 hover:text-indigo-800 font-medium">Terms of Service</a> 
                                and <a href="#" class="text-indigo-600 hover:text-indigo-800 font-medium">Privacy Policy</a>
                                <span class="text-red-500">*</span>
                            </label>
                        </div>
                        {% if form.accept_terms.errors %}
                            <p class="mt-1 ml-7 text-sm text-red-600"><i class="fas fa-exclamation-circle mr-1"></i>{{ form.accept_terms.errors[0] }}</p>
                        {% endif %}
                    </div>

                    <!-- Submit Button -->
                    <div class="space-y-4">
                        <button 
                            type="submit" 
                            class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold py-4 rounded-lg hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-4 focus:ring-indigo-300 transform hover:scale-[1.02] transition-all shadow-lg hover:shadow-xl">
                            <i class="fas fa-user-plus mr-2"></i>Create Account
                        </button>

                        <!-- Divider -->
                        <div class="relative">
                            <div class="absolute inset-0 flex items-center">
                                <div class="w-full border-t border-gray-300"></div>
                            </div>
                            <div class="relative flex justify-center text-sm">
                                <span class="px-4 bg-white text-gray-500">Already have an account?</span>
                            </div>
                        </div>

                        <!-- Login Link -->
                        <a href="{{ url_for('auth.login') }}" 
                           class="block w-full text-center px-4 py-3 border-2 border-indigo-600 text-indigo-600 font-semibold rounded-lg hover:bg-indigo-50 transition-colors">
                            <i class="fas fa-sign-in-alt mr-2"></i>Sign In Instead
                        </a>
                    </div>
                </form>
            </div>

            <!-- Footer Notice -->
            <div class="bg-gray-50 px-8 py-4 border-t border-gray-200">
                <div class="flex items-start space-x-3 text-xs text-gray-600">
                    <i class="fas fa-info-circle text-blue-500 mt-0.5"></i>
                    <p>
                        <strong>Note:</strong> This platform is for authorized government personnel only. 
                        Your registration will be reviewed by an administrator before access is granted.
                    </p>
                </div>
            </div>
        </div>

        <!-- Additional Info Cards -->
        <div class="grid md:grid-cols-3 gap-4 mt-6">
            <div class="bg-white p-4 rounded-lg shadow-md border border-gray-100 text-center">
                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-chart-bar text-blue-600 text-xl"></i>
                </div>
                <h4 class="font-semibold text-gray-900 mb-1">Real-time Analytics</h4>
                <p class="text-xs text-gray-600">Access live transport data and insights</p>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow-md border border-gray-100 text-center">
                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-shield-alt text-green-600 text-xl"></i>
                </div>
                <h4 class="font-semibold text-gray-900 mb-1">Secure Platform</h4>
                <p class="text-xs text-gray-600">Enterprise-grade security & encryption</p>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow-md border border-gray-100 text-center">
                <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-users text-purple-600 text-xl"></i>
                </div>
                <h4 class="font-semibold text-gray-900 mb-1">Collaboration</h4>
                <p class="text-xs text-gray-600">Work together across departments</p>
            </div>
        </div>
    </div>
</div>

<script>
    // Password visibility toggle
    function togglePassword(fieldId, iconId) {
        const field = document.getElementById(fieldId);
        const icon = document.getElementById(iconId);
        
        if (field.type === 'password') {
            field.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            field.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }

    // Password strength checker
    document.getElementById('password')?.addEventListener('input', function(e) {
        const password = e.target.value;
        const strengthBar = document.getElementById('passwordStrength');
        const strengthText = document.getElementById('passwordStrengthText');
        
        let strength = 0;
        let color = 'bg-red-500';
        let text = 'Weak';
        
        if (password.length >= 8) strength += 25;
        if (/[a-z]/.test(password)) strength += 25;
        if (/[A-Z]/.test(password)) strength += 25;
        if (/\d/.test(password)) strength += 12.5;
        if (/[@$!%*?&]/.test(password)) strength += 12.5;
        
        if (strength >= 75) {
            color = 'bg-green-500';
            text = 'Strong';
        } else if (strength >= 50) {
            color = 'bg-yellow-500';
            text = 'Medium';
        }
        
        strengthBar.style.width = strength + '%';
        strengthBar.className = 'h-full transition-all duration-300 ' + color;
        strengthText.textContent = text;
        strengthText.className = 'font-medium ' + (strength >= 75 ? 'text-green-600' : strength >= 50 ? 'text-yellow-600' : 'text-red-600');
    });

    // Password match checker
    document.getElementById('confirmPassword')?.addEventListener('input', function(e) {
        const password = document.getElementById('password').value;
        const confirmPassword = e.target.value;
        const matchIndicator = document.getElementById('passwordMatch');
        
        if (confirmPassword.length > 0) {
            if (password === confirmPassword) {
                matchIndicator.classList.remove('hidden');
                matchIndicator.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle mr-1"></i>Passwords match</span>';
            } else {
                matchIndicator.classList.remove('hidden');
                matchIndicator.innerHTML = '<span class="text-red-600"><i class="fas fa-times-circle mr-1"></i>Passwords do not match</span>';
            }
        } else {
            matchIndicator.classList.add('hidden');
        }
    });

    // Form progress tracker
    const form = document.getElementById('registrationForm');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    
    function updateProgress() {
        const inputs = form.querySelectorAll('input[required], select[required]');
        let filled = 0;
        
        inputs.forEach(input => {
            if (input.type === 'checkbox') {
                if (input.checked) filled++;
            } else if (input.value.trim() !== '') {
                filled++;
            }
        });
        
        const progress = Math.round((filled / inputs.length) * 100);
        progressBar.style.width = progress + '%';
        progressText.textContent = progress + '%';
    }
    
    form?.addEventListener('input', updateProgress);
    form?.addEventListener('change', updateProgress);
    
    // Initial progress update
    updateProgress();
</script>
{% endblock %}